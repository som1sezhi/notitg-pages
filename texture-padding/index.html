
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://som1sezhi.github.io/notitg-pages/texture-padding/">
      
      
        <link rel="prev" href="../shader-variables/">
      
      
        <link rel="next" href="../xml-lua-highlighting/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.2.3">
    
    
      
        <title>Texture padding (NPOT textures) - NotITG Pages</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0e669242.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.85d0ee34.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="pink" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#texture-padding-npot-textures" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="NotITG Pages" class="md-header__button md-logo" aria-label="NotITG Pages" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NotITG Pages
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Texture padding (NPOT textures)
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="pink" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="pink" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="NotITG Pages" class="md-nav__button md-logo" aria-label="NotITG Pages" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    NotITG Pages
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../shader-variables/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Shader variables
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Texture padding (NPOT textures)
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Texture padding (NPOT textures)
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#texture-coordinates-vs-image-coordinates" class="md-nav__link">
    Texture coordinates vs. image coordinates
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dealing-with-npot-textures" class="md-nav__link">
    Dealing with NPOT textures
  </a>
  
    <nav class="md-nav" aria-label="Dealing with NPOT textures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#img2tex-for-shaders" class="md-nav__link">
    img2tex() (for shaders)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#img2tex-for-lua" class="md-nav__link">
    img2tex() (for Lua)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npot-textures-on-models" class="md-nav__link">
    NPOT textures on models
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../xml-lua-highlighting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    XML-Lua syntax highlighting
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#texture-coordinates-vs-image-coordinates" class="md-nav__link">
    Texture coordinates vs. image coordinates
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dealing-with-npot-textures" class="md-nav__link">
    Dealing with NPOT textures
  </a>
  
    <nav class="md-nav" aria-label="Dealing with NPOT textures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#img2tex-for-shaders" class="md-nav__link">
    img2tex() (for shaders)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#img2tex-for-lua" class="md-nav__link">
    img2tex() (for Lua)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#npot-textures-on-models" class="md-nav__link">
    NPOT textures on models
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="texture-padding-npot-textures">Texture padding (NPOT textures)<a class="headerlink" href="#texture-padding-npot-textures" title="Permanent link">&para;</a></h1>
<p>NotITG likes textures with dimensions that are powers of 2 (128x128, 512x256, etc.). If you try to load an image with dimensions that are Not Powers of Two (NPOT), NotITG will pad out the dimensions to the next highest powers of two.</p>
<p>For example, here is a 200x150 image:</p>
<p><img alt="cool texture" src="../imgs/cool_texture.png" /></p>
<p>If loaded into NotITG as a sprite texture, it gets padded out to 256x256:</p>
<p><img alt="cool texture with black padding on bottom and right" src="../imgs/cool_texture_padded.png" /></p>
<p>(The padding here is colored black for visualization purposes. In reality it could be transparent, contain garbage data, or in the case of AFT textures, actually be black.)</p>
<h2 id="texture-coordinates-vs-image-coordinates">Texture coordinates vs. image coordinates<a class="headerlink" href="#texture-coordinates-vs-image-coordinates" title="Permanent link">&para;</a></h2>
<p>This behavior gives rise to a distinction between <em>texture size</em> and <em>image size</em>, and between <em>texture coordinates</em> and <em>image coordinates</em>:</p>
<p><img alt="diagram visualizing texture and image coordinates on the cool texture" src="../imgs/cool_texture_diagram.png" /></p>
<ul>
<li>The <strong>texture size</strong> is the size of the whole texture, including the padding. The dimensions will always be powers of 2. In the above example, the texture size would be 256x256.</li>
<li>The <strong>image size</strong> is the size of the image without padding. In the above example, the image size would be 200x150.</li>
<li>With <strong>texture coordinates</strong>, values in the range [0, 1] span over the whole texture, including the padding. In the above example, (1, 1) would refer to the <em>very</em> bottom-right corner of the texture, while the bottom-right corner of the actual image would be located at (200/256, 150/256), or (0.78125, 0.5859375).</li>
<li>With <strong>image coordinates</strong>, values in the range [0, 1] span only over the image within the texture, excluding the padding. In the above example, (1, 1) would refer to the bottom-right corner of the actual image, the same location as (0.78125, 0.5859375) in texture coordinates.</li>
</ul>
<p>In Lua, you can grab the texture/image dimensions of a <code>RageTexture</code> by calling its <code>GetTextureWidth()</code>/<code>GetImageWidth()</code> and <code>GetTextureHeight()</code>/<code>GetImageHeight()</code> methods.</p>
<p>In shaders, the texture and image sizes are available through the uniforms <code>textureSize</code> and <code>imageSize</code> (except in <a href="#npot-textures-on-models">model shaders</a>). Additionally, in the fragment shader, the current texture/image coordinates are available through the varying variables <code>textureCoord</code> and <code>imageCoord</code>.</p>
<h2 id="dealing-with-npot-textures">Dealing with NPOT textures<a class="headerlink" href="#dealing-with-npot-textures" title="Permanent link">&para;</a></h2>
<p>If you actually assign a NPOT texture to a sprite, you may notice that the image displays correctly, without any padding visible. In those cases, NotITG automatically sets the sprite's texture coordinates to only cover the image's portion of the texture, hiding away the padding. However, in situations where you assign texture coordinates yourself or otherwise manipulate them directly, you will have to deal with the padding yourself.</p>
<p>This can be especially problematic if you're using something like <code>Sprite.customtexturerect()</code> or <code>Sprite.texcoordvelocity()</code> to repeat a texture across a sprite. The entire texture will be repeated, including the padding, leaving weird gaps in between the images.</p>
<p><img alt="the cool texture, tiled with weird gaps in between the repetitions" src="../imgs/cool_texture_tiling_bad.jpg" /></p>
<p>The best way to deal with this issue, and with NPOT texture issues in general, is to just avoid them entirely and use power-of-2 textures. That way, you won't have to worry about the differences between texture and image coordinates, as they will be equivalent, and stuff like <code>customtexturerect()</code> will work as expected.</p>
<p>This is unfortunately not always possible, particularly when working with AFTs (the image size will be the size of your window, which will likely not have power-of-2 dimensions). You will have to manually account for the padding when inputting texture coordinates. You also won't be able to  repeat textures using <code>customtexturerect()</code>, etc. properly at all; you'll have to emulate these effects using a shader<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup>. Luckily for us, in all of the above cases, we have <code>img2tex()</code> to help.</p>
<h3 id="img2tex-for-shaders"><code>img2tex()</code> (for shaders)<a class="headerlink" href="#img2tex-for-shaders" title="Permanent link">&para;</a></h3>
<p>In NotITG shader code, you will often find the function <code>img2tex()</code> lying around somewhere:</p>
<div class="highlight"><pre><span></span><code><span class="kt">vec2</span><span class="w"> </span><span class="n">img2tex</span><span class="p">(</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">textureSize</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">imageSize</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<p>This function takes in a pair of image coordinates and converts them to texture coordinates. This function is very useful because it allows you to perform your manipulations in image coordinate space first, which is a lot easier to work with in many situations, before converting them to texture coordinates to plug into <code>texture2D()</code>.</p>
<p>As an example of what happens when you don't use <code>img2tex()</code> before plugging into <code>texture2D()</code>, let's say you have an AFT-sprite setup and you want to create an effect where the AFT texture tiles across the screen. You write this shader:</p>
<div class="highlight"><pre><span></span><code><span class="cp">#version 120</span>

<span class="k">varying</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">imageCoord</span><span class="p">;</span>

<span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">sampler0</span><span class="p">;</span>

<span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">vec2</span><span class="w"> </span><span class="n">uv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imageCoord</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// repeat across the screen 4 times</span>
<span class="w">    </span><span class="n">uv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fract</span><span class="p">(</span><span class="n">uv</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">4.0</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// sample from texture</span>
<span class="w">    </span><span class="nb">gl_FragColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture2D</span><span class="p">(</span><span class="n">sampler0</span><span class="p">,</span><span class="w"> </span><span class="n">uv</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>and get this horrible-looking result<sup id="fnref:2"><a class="footnote-ref" href="#fn:2">2</a></sup>:</p>
<p><img alt="a repeated AFT texture with ugly padding in between repetitions" src="../imgs/aft_tiling_bad.jpg" /></p>
<p>The problem here is that <code>uv</code> is specified in terms of image coordinates, but <code>texture2D()</code> expects texture coordinates, so when <code>uv</code> is passed into <code>texture2D()</code>, the game starts sampling across the entire texture, including the ugly padding.</p>
<p>To fix this, you can use <code>img2tex()</code> to convert <code>uv</code> to texture coordinates before passing into <code>texture2D()</code>:</p>
<div class="highlight"><pre><span></span><code><span class="cp">#version 120</span>

<span class="k">varying</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">imageCoord</span><span class="p">;</span>

<span class="k">uniform</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">textureSize</span><span class="p">;</span>
<span class="k">uniform</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">imageSize</span><span class="p">;</span>
<span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">sampler0</span><span class="p">;</span>

<span class="kt">vec2</span><span class="w"> </span><span class="n">img2tex</span><span class="p">(</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">textureSize</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">imageSize</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">vec2</span><span class="w"> </span><span class="n">uv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imageCoord</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// repeat across the screen 4 times</span>
<span class="w">    </span><span class="n">uv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fract</span><span class="p">(</span><span class="n">uv</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">4.0</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// sample from texture, converting to texture coords first</span>
<span class="w">    </span><span class="nb">gl_FragColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture2D</span><span class="p">(</span><span class="n">sampler0</span><span class="p">,</span><span class="w"> </span><span class="n">img2tex</span><span class="p">(</span><span class="n">uv</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div>
<p><img alt="a repeated AFT texture with no gaps in between" src="../imgs/aft_tiling_good.jpg" /></p>
<h3 id="img2tex-for-lua"><code>img2tex()</code> (for Lua)<a class="headerlink" href="#img2tex-for-lua" title="Permanent link">&para;</a></h3>
<p>If you're not writing a shader but still need to convert image coordinates to texture coordinates in Lua, you can adapt <code>img2tex()</code> for use in Lua code. AFAIK there is no commonly-used piece of code for doing this sort of thing, but here's one I made just now:</p>
<div class="highlight"><pre><span></span><code><span class="kr">function</span> <span class="nf">img2tex</span><span class="p">(</span><span class="n">texture</span><span class="p">,</span> <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">texw</span><span class="p">,</span> <span class="n">texh</span> <span class="o">=</span> <span class="n">texture</span><span class="p">:</span><span class="n">GetTextureWidth</span><span class="p">(),</span> <span class="n">texture</span><span class="p">:</span><span class="n">GetTextureHeight</span><span class="p">()</span>
    <span class="kd">local</span> <span class="n">imgw</span><span class="p">,</span> <span class="n">imgh</span> <span class="o">=</span> <span class="n">texture</span><span class="p">:</span><span class="n">GetImageWidth</span><span class="p">(),</span> <span class="n">texture</span><span class="p">:</span><span class="n">GetImageHeight</span><span class="p">()</span>
    <span class="kr">return</span> <span class="n">vx</span> <span class="o">/</span> <span class="n">texw</span> <span class="o">*</span> <span class="n">imgw</span><span class="p">,</span> <span class="n">vy</span> <span class="o">/</span> <span class="n">texh</span> <span class="o">*</span> <span class="n">imgh</span>
<span class="kr">end</span>
</code></pre></div>
<p>This could be useful for e.g. setting texture coordinates on a polygon with an AFT texture:</p>
<div class="highlight"><pre><span></span><code><span class="n">polygon</span><span class="p">:</span><span class="n">SetVertexTexCoord</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">img2tex</span><span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
</code></pre></div>
<h2 id="npot-textures-on-models">NPOT textures on models<a class="headerlink" href="#npot-textures-on-models" title="Permanent link">&para;</a></h2>
<p>NPOT textures on models (specifically, textures assigned to the model directly via its TXT file) are handled quite a bit differently. Instead of padding out the image, the image is <em>stretched out</em> to the next-highest power-of-2 dimensions. This is probably so that the original texture coordinates that come with the model can still be used to sample from its texture unchanged.</p>
<p>For example, the 200x150 image from earlier would be resized to 256x256 as a model texture:</p>
<p><img alt="a cool texture stretched out to fill a 256x256 space" src="../imgs/cool_texture_stretched.png" /></p>
<p>This stretching does <em>not</em> seem to be applied to NPOT textures originating from somewhere else (e.g. an AFT) and applied to the model later. This can cause problems when the model's original texture coordinates are used to sample the texture you just applied, leading to padding showing up on screen. You could try to correct the texture coordinates on the model yourself before loading it into the game, or you could correct it in-game using a shader and <code>img2tex()</code>.</p>
<p>If you go the shader route, beware that <code>imageSize</code> and <code>textureSize</code> are <em>not</em> passed into model shaders by default, for some reason. You will have to pass those in yourself for <code>img2tex()</code> to work, e.g.:</p>
<div class="highlight"><pre><span></span><code><span class="n">myModel</span><span class="p">:</span><span class="n">GetShader</span><span class="p">():</span><span class="n">uniform2f</span><span class="p">(</span><span class="s1">&#39;textureSize&#39;</span><span class="p">,</span> <span class="n">tex</span><span class="p">:</span><span class="n">GetTextureWidth</span><span class="p">(),</span> <span class="n">tex</span><span class="p">:</span><span class="n">GetTextureHeight</span><span class="p">())</span>
<span class="n">myModel</span><span class="p">:</span><span class="n">GetShader</span><span class="p">():</span><span class="n">uniform2f</span><span class="p">(</span><span class="s1">&#39;imageSize&#39;</span><span class="p">,</span> <span class="n">tex</span><span class="p">:</span><span class="n">GetImageWidth</span><span class="p">(),</span> <span class="n">tex</span><span class="p">:</span><span class="n">GetImageHeight</span><span class="p">())</span>
</code></pre></div>
<p>Also, note that the model's original texture coordinates act as your desired <em>image</em> coordinates in this situation, which you want to convert to texture coordinates for the texture you just applied. Since the model's original texture coordinates is what's being passed into <code>textureCoord</code>, you'll want to do <code>img2tex(textureCoord)</code> instead of  <code>img2tex(imageCoord)</code>.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>Or at least, a shader would be the simplest/most direct way of going about it IMO. I can think of some quite convoluted shaderless approaches...&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p>You may notice that the AFT image here looks like it's positioned at the bottom-left corner of the texture instead of the top-left. In fact, the AFT image is actually still positioned at the top-left of the texture, but the image is <a href="../imgs/aft_flipped.png">flipped vertically for some reason</a>. Common AFT-sprite setups, such as the Mirin Template's <code>sprite()</code>, will then flip the sprite vertically to compensate, so the screen appears right-side up, but the (0, 0) texture/image coordinate will end up at the bottom-left corner of the image.&#160;<a class="footnote-backref" href="#fnref:2" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
</ol>
</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.78eede0e.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
      
    
  </body>
</html>